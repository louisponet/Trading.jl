<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Developers · Trading.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://louisponet.github.io/Trading.jl/stable/developers/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Trading.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Getting Started</a></li><li><span class="tocitem">Topics</span><ul><li><a class="tocitem" href="../trader/">Trader</a></li><li><a class="tocitem" href="../brokers/">Brokers</a></li><li><a class="tocitem" href="../portfolio/">Portfolio</a></li><li><a class="tocitem" href="../time/">Time</a></li><li><a class="tocitem" href="../asset_ledgers/">Asset Ledgers</a></li><li><a class="tocitem" href="../orderbook/">OrderBook</a></li><li><a class="tocitem" href="../indicators/">Indicators</a></li></ul></li><li><span class="tocitem">Strategies</span><ul><li><a class="tocitem" href="../strategies/">Tutorial</a></li><li><a class="tocitem" href="../idea_generation/">Idea Generation</a></li><li><a class="tocitem" href="../strategies/slow_fast/">Slow Fast</a></li><li><a class="tocitem" href="../strategies/cointegration/">Cointegration</a></li><li><a class="tocitem" href="../strategies/orderbook_imbalance/">OrderBook Imbalance</a></li></ul></li><li><span class="tocitem">Developers</span><ul><li class="is-active"><a class="tocitem" href>Developers</a><ul class="internal"><li><a class="tocitem" href="#Implementing-a-new-[AbstractBroker](@ref)"><span>Implementing a new <code>AbstractBroker</code></span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developers</a></li><li class="is-active"><a href>Developers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Developers</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/louisponet/Trading.jl/blob/master/docs/src/developers.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Developers"><a class="docs-heading-anchor" href="#Developers">Developers</a><a id="Developers-1"></a><a class="docs-heading-anchor-permalink" href="#Developers" title="Permalink"></a></h1><h2 id="Implementing-a-new-[AbstractBroker](@ref)"><a class="docs-heading-anchor" href="#Implementing-a-new-[AbstractBroker](@ref)">Implementing a new <a href="../brokers/#Trading.AbstractBroker"><code>AbstractBroker</code></a></a><a id="Implementing-a-new-[AbstractBroker](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-a-new-[AbstractBroker](@ref)" title="Permalink"></a></h2><p>We will use <a href="../brokers/#Trading.AlpacaBroker"><code>AlpacaBroker</code></a> as an example for how to implement the <a href="../brokers/#Trading.AbstractBroker"><code>AbstractBroker</code></a> interface.</p><pre><code class="language-julia hljs">Base.@kwdef mutable struct AlpacaBroker &lt;: AbstractBroker
    key_id::String
    secret_key::String
    cache::DataCache = DataCache()
    rate::Int = 200
    last::TimeDate = current_time()
    @atomic nrequests::Int

    function AlpacaBroker(key_id, secret_key, cache, rate, last, nrequests)
        try
            header = [&quot;APCA-API-KEY-ID&quot; =&gt; key_id, &quot;APCA-API-SECRET-KEY&quot; =&gt; secret_key]
            testurl = URI(&quot;https://paper-api.alpaca.markets/v2/clock&quot;)
            resp = HTTP.get(testurl, header)
        catch e
            throw(AuthenticationException(e))
        end
        return new(key_id, secret_key, cache, rate, last, nrequests)
    end
end</code></pre><p><code>key_id</code> and <code>secret_key</code> are used in the constructor for authentication verification, and later on for making api calls. However, these are not assumed to be present and are thus not part of the interface.</p><h3 id=".cache-[DataCache](@ref)"><a class="docs-heading-anchor" href="#.cache-[DataCache](@ref)"><code>.cache</code> <a href="#Trading.DataCache"><code>DataCache</code></a></a><a id=".cache-[DataCache](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#.cache-[DataCache](@ref)" title="Permalink"></a></h3><p>The functions:</p><ul><li><code>bars(broker)</code></li><li><code>quotes(broker)</code></li><li><code>trades(broker)</code></li></ul><p>are defined for an <code>AbstractBroker</code>, but assume that the <code>AbstractBroker</code> has a field <code>.cache</code> which is a <a href="#Trading.DataCache"><code>DataCache</code></a> so it is advised for any <code>AbstractBroker</code> to follow the convention that it has a <code>.cache</code> field.</p><h3 id="Wrapper-Broker"><a class="docs-heading-anchor" href="#Wrapper-Broker">Wrapper Broker</a><a id="Wrapper-Broker-1"></a><a class="docs-heading-anchor-permalink" href="#Wrapper-Broker" title="Permalink"></a></h3><p>If you would want to construct a &quot;wrapper&quot; broker, i.e. wrapping the <code>broker</code> which supplies the actual API to alter its default behavior (<a href="../brokers/#Trading.HistoricalBroker"><code>HistoricalBroker</code></a> is an example of this), you should overload the <code>broker(broker)</code> function to return the &quot;actual&quot; broker:</p><pre><code class="language-julia hljs">broker(b::HistoricalBroker) = b.broker
broker(b::AlpacaBroker) = b</code></pre><h3 id="data_query"><a class="docs-heading-anchor" href="#data_query"><code>data_query</code></a><a id="data_query-1"></a><a class="docs-heading-anchor-permalink" href="#data_query" title="Permalink"></a></h3><p>Next up is the <code>data_query(broker, asset, start, stop, args...; section = [&quot;bars&quot; or &quot;quotes&quot; or&quot;trades&quot;], [timeframe=DateTime if section == &quot;bars&quot;])</code> function, which performs the actual api calls to retrieve either <code>bars</code>, <code>quotes</code> or <code>trades</code> from the <code>broker</code>. What to retrieve is communicated through the <code>section</code> kwarg, and in the case of <code>bars</code> it will be called using the <code>timeframe</code> kwarg. This should return a <code>TimeFrame</code>.</p><h3 id="Bars"><a class="docs-heading-anchor" href="#Bars">Bars</a><a id="Bars-1"></a><a class="docs-heading-anchor-permalink" href="#Bars" title="Permalink"></a></h3><p>The <code>bars(broker, msg::Vector)</code> function should be overloaded to be used in <a href="../brokers/#Trading.DataStream"><code>DataStream</code></a> to parse incoming bar updates. It should return a <code>Vector</code> of <code>(asset, (datetime, (bar_open, bar_high, bar_low, bar_close, bar_volume)))</code>:</p><pre><code class="language-julia hljs">function bars(::Union{AlpacaBroker,MockBroker}, msg::AbstractVector)
    return map(filter(x -&gt; x[:T] == &quot;b&quot;, msg)) do bar
        asset = bar[:S]
        return asset, (parse_time(bar[:t]), (bar[:o], bar[:h], bar[:l], bar[:c], bar[:v]))
    end
end</code></pre><p>The function <code>subscribe_bars(broker, asset, websocket)</code> should be overloaded in order to communicate to a <a href="../brokers/#Trading.DataStream"><code>DataStream</code></a> which <code>assets</code> we want to receive updates for.</p><p><code>data_stream_url(broker)</code> should point to a url from which we can stream bar update data. <code>authenticate_data(broker)</code> is called just after opening the stream.</p><h3 id="Orders"><a class="docs-heading-anchor" href="#Orders">Orders</a><a id="Orders-1"></a><a class="docs-heading-anchor-permalink" href="#Orders" title="Permalink"></a></h3><p>The first function to overload is <a href="../brokers/#Trading.submit_order"><code>submit_order(broker, order::EntityState{Purchase or Sale})</code></a> which actually submites the orders. I think the <code>AlpacaBroker</code> one can be used with other Brokers, given that a couple of overloads are defined, but I&#39;m not sure if the structure would always be the same.</p><p>Next up is <code>receive_order(broker, websocket)</code> which is called by the <code>trading_task</code> to listen to Order updates and thus potentially portfolio updates (when filled). It should return an <a href="../portfolio/#Trading.Order"><code>Order</code></a>.</p><p>To be able to open the <a href="../brokers/#Trading.TradingStream"><code>TradingStream</code></a> <code>trading_stream_url(broker)</code> should be overloaded and <code>authenticate_trading(broker, websocket)</code> which also sends the right message to start listening to the updates.</p><h3 id="Account-Details"><a class="docs-heading-anchor" href="#Account-Details">Account Details</a><a id="Account-Details-1"></a><a class="docs-heading-anchor-permalink" href="#Account-Details" title="Permalink"></a></h3><p>Upon construction a <a href="../trader/#Trading.Trader"><code>Trader</code></a> will fill out the current portfolio by calling <code>account_details(broker)</code> which should return <code>(cash, positions)</code> where <code>positions = [(asset, quantity), (asset, quantity), ...]</code>.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="Trading.DataCache" href="#Trading.DataCache"><code>Trading.DataCache</code></a> — <span class="docstring-category">Type</span></header><section><div><p>A cache used by <a href="../brokers/#Brokers">Brokers</a> to store previously retrieved historical data.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/louisponet/Trading.jl/blob/45167ffc25b28b398d883a7ffdfccdd3c2178767/src/datacache.jl#L6-L8">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../strategies/orderbook_imbalance/">« OrderBook Imbalance</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 19 May 2023 06:57">Friday 19 May 2023</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
